{"ast":null,"code":"import { jsonStringify, computeBytesCount, deepClone, noop, isExperimentalFeatureEnabled, SESSION_TIME_OUT_DELAY, ContextHistory } from '@datadog/browser-core';\nexport var FEATURE_FLAG_CONTEXT_TIME_OUT_DELAY = SESSION_TIME_OUT_DELAY;\n/**\n * Start feature flag contexts\n *\n * Feature flag contexts follow the life of views.\n * A new context is added when a view is created and ended when the view is ended\n *\n * Note: we choose not to add a new context at each evaluation to save memory\n */\nexport function startFeatureFlagContexts(lifeCycle, computeBytesCountImpl) {\n  if (computeBytesCountImpl === void 0) {\n    computeBytesCountImpl = computeBytesCount;\n  }\n  if (!isExperimentalFeatureEnabled('feature_flags')) {\n    return {\n      findFeatureFlagEvaluations: function () {\n        return undefined;\n      },\n      getFeatureFlagBytesCount: function () {\n        return 0;\n      },\n      addFeatureFlagEvaluation: noop\n    };\n  }\n  var featureFlagContexts = new ContextHistory(FEATURE_FLAG_CONTEXT_TIME_OUT_DELAY);\n  var bytesCountCache;\n  lifeCycle.subscribe(4 /* VIEW_ENDED */, function (_a) {\n    var endClocks = _a.endClocks;\n    featureFlagContexts.closeActive(endClocks.relative);\n  });\n  lifeCycle.subscribe(2 /* VIEW_CREATED */, function (_a) {\n    var startClocks = _a.startClocks;\n    featureFlagContexts.add({}, startClocks.relative);\n    bytesCountCache = undefined;\n  });\n  return {\n    findFeatureFlagEvaluations: function (startTime) {\n      return featureFlagContexts.find(startTime);\n    },\n    getFeatureFlagBytesCount: function () {\n      var currentContext = featureFlagContexts.find();\n      if (!currentContext) {\n        return 0;\n      }\n      if (bytesCountCache === undefined) {\n        bytesCountCache = computeBytesCountImpl(jsonStringify(currentContext));\n      }\n      return bytesCountCache;\n    },\n    addFeatureFlagEvaluation: function (key, value) {\n      var currentContext = featureFlagContexts.find();\n      if (currentContext) {\n        currentContext[key] = deepClone(value);\n        bytesCountCache = undefined;\n      }\n    }\n  };\n}","map":{"version":3,"names":["jsonStringify","computeBytesCount","deepClone","noop","isExperimentalFeatureEnabled","SESSION_TIME_OUT_DELAY","ContextHistory","FEATURE_FLAG_CONTEXT_TIME_OUT_DELAY","startFeatureFlagContexts","lifeCycle","computeBytesCountImpl","findFeatureFlagEvaluations","undefined","getFeatureFlagBytesCount","addFeatureFlagEvaluation","featureFlagContexts","bytesCountCache","subscribe","_a","endClocks","closeActive","relative","startClocks","add","startTime","find","currentContext","key","value"],"sources":["/Users/sean.dever/Desktop/PersonalRepos/apm-enablement-sessions/rum_and_trace_correlation/rum_app/node_modules/@datadog/browser-rum-core/src/domain/contexts/featureFlagContext.ts"],"sourcesContent":["import type { RelativeTime, ContextValue, Context } from '@datadog/browser-core'\nimport {\n  jsonStringify,\n  computeBytesCount,\n  deepClone,\n  noop,\n  isExperimentalFeatureEnabled,\n  SESSION_TIME_OUT_DELAY,\n  ContextHistory,\n} from '@datadog/browser-core'\nimport type { LifeCycle } from '../lifeCycle'\nimport { LifeCycleEventType } from '../lifeCycle'\n\nexport const FEATURE_FLAG_CONTEXT_TIME_OUT_DELAY = SESSION_TIME_OUT_DELAY\n\nexport type FeatureFlagContext = Context\n\nexport interface FeatureFlagContexts {\n  findFeatureFlagEvaluations: (startTime?: RelativeTime) => FeatureFlagContext | undefined\n  getFeatureFlagBytesCount: () => number\n  addFeatureFlagEvaluation: (key: string, value: ContextValue) => void\n}\n\n/**\n * Start feature flag contexts\n *\n * Feature flag contexts follow the life of views.\n * A new context is added when a view is created and ended when the view is ended\n *\n * Note: we choose not to add a new context at each evaluation to save memory\n */\nexport function startFeatureFlagContexts(\n  lifeCycle: LifeCycle,\n  computeBytesCountImpl = computeBytesCount\n): FeatureFlagContexts {\n  if (!isExperimentalFeatureEnabled('feature_flags')) {\n    return {\n      findFeatureFlagEvaluations: () => undefined,\n      getFeatureFlagBytesCount: () => 0,\n      addFeatureFlagEvaluation: noop,\n    }\n  }\n\n  const featureFlagContexts = new ContextHistory<FeatureFlagContext>(FEATURE_FLAG_CONTEXT_TIME_OUT_DELAY)\n  let bytesCountCache: number | undefined\n\n  lifeCycle.subscribe(LifeCycleEventType.VIEW_ENDED, ({ endClocks }) => {\n    featureFlagContexts.closeActive(endClocks.relative)\n  })\n\n  lifeCycle.subscribe(LifeCycleEventType.VIEW_CREATED, ({ startClocks }) => {\n    featureFlagContexts.add({}, startClocks.relative)\n    bytesCountCache = undefined\n  })\n\n  return {\n    findFeatureFlagEvaluations: (startTime?: RelativeTime) => featureFlagContexts.find(startTime),\n    getFeatureFlagBytesCount: () => {\n      const currentContext = featureFlagContexts.find()\n      if (!currentContext) {\n        return 0\n      }\n\n      if (bytesCountCache === undefined) {\n        bytesCountCache = computeBytesCountImpl(jsonStringify(currentContext)!)\n      }\n      return bytesCountCache\n    },\n    addFeatureFlagEvaluation: (key: string, value: ContextValue) => {\n      const currentContext = featureFlagContexts.find()\n      if (currentContext) {\n        currentContext[key] = deepClone(value)\n        bytesCountCache = undefined\n      }\n    },\n  }\n}\n"],"mappings":"AACA,SACEA,aAAa,EACbC,iBAAiB,EACjBC,SAAS,EACTC,IAAI,EACJC,4BAA4B,EAC5BC,sBAAsB,EACtBC,cAAc,QACT,uBAAuB;AAI9B,OAAO,IAAMC,mCAAmC,GAAGF,sBAAsB;AAUzE;;;;;;;;AAQA,OAAM,SAAUG,wBAAwBA,CACtCC,SAAoB,EACpBC,qBAAyC;EAAzC,IAAAA,qBAAA;IAAAA,qBAAA,GAAAT,iBAAyC;EAAA;EAEzC,IAAI,CAACG,4BAA4B,CAAC,eAAe,CAAC,EAAE;IAClD,OAAO;MACLO,0BAA0B,EAAE,SAAAA,CAAA;QAAM,OAAAC,SAAS;MAAT,CAAS;MAC3CC,wBAAwB,EAAE,SAAAA,CAAA;QAAM,QAAC;MAAD,CAAC;MACjCC,wBAAwB,EAAEX;KAC3B;;EAGH,IAAMY,mBAAmB,GAAG,IAAIT,cAAc,CAAqBC,mCAAmC,CAAC;EACvG,IAAIS,eAAmC;EAEvCP,SAAS,CAACQ,SAAS,qBAAgC,UAACC,EAAa;QAAXC,SAAS,GAAAD,EAAA,CAAAC,SAAA;IAC7DJ,mBAAmB,CAACK,WAAW,CAACD,SAAS,CAACE,QAAQ,CAAC;EACrD,CAAC,CAAC;EAEFZ,SAAS,CAACQ,SAAS,uBAAkC,UAACC,EAAe;QAAbI,WAAW,GAAAJ,EAAA,CAAAI,WAAA;IACjEP,mBAAmB,CAACQ,GAAG,CAAC,EAAE,EAAED,WAAW,CAACD,QAAQ,CAAC;IACjDL,eAAe,GAAGJ,SAAS;EAC7B,CAAC,CAAC;EAEF,OAAO;IACLD,0BAA0B,EAAE,SAAAA,CAACa,SAAwB;MAAK,OAAAT,mBAAmB,CAACU,IAAI,CAACD,SAAS,CAAC;IAAnC,CAAmC;IAC7FX,wBAAwB,EAAE,SAAAA,CAAA;MACxB,IAAMa,cAAc,GAAGX,mBAAmB,CAACU,IAAI,EAAE;MACjD,IAAI,CAACC,cAAc,EAAE;QACnB,OAAO,CAAC;;MAGV,IAAIV,eAAe,KAAKJ,SAAS,EAAE;QACjCI,eAAe,GAAGN,qBAAqB,CAACV,aAAa,CAAC0B,cAAc,CAAE,CAAC;;MAEzE,OAAOV,eAAe;IACxB,CAAC;IACDF,wBAAwB,EAAE,SAAAA,CAACa,GAAW,EAAEC,KAAmB;MACzD,IAAMF,cAAc,GAAGX,mBAAmB,CAACU,IAAI,EAAE;MACjD,IAAIC,cAAc,EAAE;QAClBA,cAAc,CAACC,GAAG,CAAC,GAAGzB,SAAS,CAAC0B,KAAK,CAAC;QACtCZ,eAAe,GAAGJ,SAAS;;IAE/B;GACD;AACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}