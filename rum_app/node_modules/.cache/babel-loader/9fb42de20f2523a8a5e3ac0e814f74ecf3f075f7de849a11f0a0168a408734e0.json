{"ast":null,"code":"import { isEmptyObject, mapValues, toServerDuration, isNumber } from '@datadog/browser-core';\nimport { trackViews } from './trackViews';\nexport function startViewCollection(lifeCycle, configuration, location, domMutationObservable, locationChangeObservable, foregroundContexts, featureFlagContexts, recorderApi, initialViewOptions) {\n  lifeCycle.subscribe(3 /* VIEW_UPDATED */, function (view) {\n    return lifeCycle.notify(10 /* RAW_RUM_EVENT_COLLECTED */, processViewUpdate(view, foregroundContexts, featureFlagContexts, recorderApi));\n  });\n  return trackViews(location, lifeCycle, domMutationObservable, configuration, locationChangeObservable, !configuration.trackViewsManually, initialViewOptions);\n}\nfunction processViewUpdate(view, foregroundContexts, featureFlagContexts, recorderApi) {\n  var replayStats = recorderApi.getReplayStats(view.id);\n  var featureFlagContext = featureFlagContexts.findFeatureFlagEvaluations(view.startClocks.relative);\n  var viewEvent = {\n    _dd: {\n      document_version: view.documentVersion,\n      replay_stats: replayStats\n    },\n    date: view.startClocks.timeStamp,\n    type: \"view\" /* VIEW */,\n    view: {\n      action: {\n        count: view.eventCounts.actionCount\n      },\n      frustration: {\n        count: view.eventCounts.frustrationCount\n      },\n      cumulative_layout_shift: view.cumulativeLayoutShift,\n      first_byte: toServerDuration(view.timings.firstByte),\n      dom_complete: toServerDuration(view.timings.domComplete),\n      dom_content_loaded: toServerDuration(view.timings.domContentLoaded),\n      dom_interactive: toServerDuration(view.timings.domInteractive),\n      error: {\n        count: view.eventCounts.errorCount\n      },\n      first_contentful_paint: toServerDuration(view.timings.firstContentfulPaint),\n      first_input_delay: toServerDuration(view.timings.firstInputDelay),\n      first_input_time: toServerDuration(view.timings.firstInputTime),\n      is_active: view.isActive,\n      name: view.name,\n      largest_contentful_paint: toServerDuration(view.timings.largestContentfulPaint),\n      load_event: toServerDuration(view.timings.loadEvent),\n      loading_time: discardNegativeDuration(toServerDuration(view.loadingTime)),\n      loading_type: view.loadingType,\n      long_task: {\n        count: view.eventCounts.longTaskCount\n      },\n      resource: {\n        count: view.eventCounts.resourceCount\n      },\n      time_spent: toServerDuration(view.duration),\n      in_foreground_periods: foregroundContexts.selectInForegroundPeriodsFor(view.startClocks.relative, view.duration)\n    },\n    feature_flags: featureFlagContext && !isEmptyObject(featureFlagContext) ? featureFlagContext : undefined,\n    session: {\n      has_replay: replayStats ? true : undefined\n    }\n  };\n  if (!isEmptyObject(view.customTimings)) {\n    viewEvent.view.custom_timings = mapValues(view.customTimings, toServerDuration);\n  }\n  return {\n    rawRumEvent: viewEvent,\n    startTime: view.startClocks.relative,\n    domainContext: {\n      location: view.location\n    }\n  };\n}\nfunction discardNegativeDuration(duration) {\n  return isNumber(duration) && duration < 0 ? undefined : duration;\n}","map":{"version":3,"names":["isEmptyObject","mapValues","toServerDuration","isNumber","trackViews","startViewCollection","lifeCycle","configuration","location","domMutationObservable","locationChangeObservable","foregroundContexts","featureFlagContexts","recorderApi","initialViewOptions","subscribe","view","notify","processViewUpdate","trackViewsManually","replayStats","getReplayStats","id","featureFlagContext","findFeatureFlagEvaluations","startClocks","relative","viewEvent","_dd","document_version","documentVersion","replay_stats","date","timeStamp","type","action","count","eventCounts","actionCount","frustration","frustrationCount","cumulative_layout_shift","cumulativeLayoutShift","first_byte","timings","firstByte","dom_complete","domComplete","dom_content_loaded","domContentLoaded","dom_interactive","domInteractive","error","errorCount","first_contentful_paint","firstContentfulPaint","first_input_delay","firstInputDelay","first_input_time","firstInputTime","is_active","isActive","name","largest_contentful_paint","largestContentfulPaint","load_event","loadEvent","loading_time","discardNegativeDuration","loadingTime","loading_type","loadingType","long_task","longTaskCount","resource","resourceCount","time_spent","duration","in_foreground_periods","selectInForegroundPeriodsFor","feature_flags","undefined","session","has_replay","customTimings","custom_timings","rawRumEvent","startTime","domainContext"],"sources":["/Users/sean.dever/Desktop/PersonalRepos/react-app/node_modules/@datadog/browser-rum-core/src/domain/rumEventsCollection/view/viewCollection.ts"],"sourcesContent":["import type { Duration, ServerDuration, Observable } from '@datadog/browser-core'\nimport { isEmptyObject, mapValues, toServerDuration, isNumber } from '@datadog/browser-core'\nimport type { RecorderApi } from '../../../boot/rumPublicApi'\nimport type { RawRumViewEvent } from '../../../rawRumEvent.types'\nimport { RumEventType } from '../../../rawRumEvent.types'\nimport type { LifeCycle, RawRumEventCollectedData } from '../../lifeCycle'\nimport { LifeCycleEventType } from '../../lifeCycle'\nimport type { ForegroundContexts } from '../../contexts/foregroundContexts'\nimport type { LocationChange } from '../../../browser/locationChangeObservable'\nimport type { RumConfiguration } from '../../configuration'\nimport type { FeatureFlagContexts } from '../../contexts/featureFlagContext'\nimport type { ViewEvent, ViewOptions } from './trackViews'\nimport { trackViews } from './trackViews'\n\nexport function startViewCollection(\n  lifeCycle: LifeCycle,\n  configuration: RumConfiguration,\n  location: Location,\n  domMutationObservable: Observable<void>,\n  locationChangeObservable: Observable<LocationChange>,\n  foregroundContexts: ForegroundContexts,\n  featureFlagContexts: FeatureFlagContexts,\n  recorderApi: RecorderApi,\n  initialViewOptions?: ViewOptions\n) {\n  lifeCycle.subscribe(LifeCycleEventType.VIEW_UPDATED, (view) =>\n    lifeCycle.notify(\n      LifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n      processViewUpdate(view, foregroundContexts, featureFlagContexts, recorderApi)\n    )\n  )\n\n  return trackViews(\n    location,\n    lifeCycle,\n    domMutationObservable,\n    configuration,\n    locationChangeObservable,\n    !configuration.trackViewsManually,\n    initialViewOptions\n  )\n}\n\nfunction processViewUpdate(\n  view: ViewEvent,\n  foregroundContexts: ForegroundContexts,\n  featureFlagContexts: FeatureFlagContexts,\n  recorderApi: RecorderApi\n): RawRumEventCollectedData<RawRumViewEvent> {\n  const replayStats = recorderApi.getReplayStats(view.id)\n  const featureFlagContext = featureFlagContexts.findFeatureFlagEvaluations(view.startClocks.relative)\n\n  const viewEvent: RawRumViewEvent = {\n    _dd: {\n      document_version: view.documentVersion,\n      replay_stats: replayStats,\n    },\n    date: view.startClocks.timeStamp,\n    type: RumEventType.VIEW,\n    view: {\n      action: {\n        count: view.eventCounts.actionCount,\n      },\n      frustration: {\n        count: view.eventCounts.frustrationCount,\n      },\n      cumulative_layout_shift: view.cumulativeLayoutShift,\n      first_byte: toServerDuration(view.timings.firstByte),\n      dom_complete: toServerDuration(view.timings.domComplete),\n      dom_content_loaded: toServerDuration(view.timings.domContentLoaded),\n      dom_interactive: toServerDuration(view.timings.domInteractive),\n      error: {\n        count: view.eventCounts.errorCount,\n      },\n      first_contentful_paint: toServerDuration(view.timings.firstContentfulPaint),\n      first_input_delay: toServerDuration(view.timings.firstInputDelay),\n      first_input_time: toServerDuration(view.timings.firstInputTime),\n      is_active: view.isActive,\n      name: view.name,\n      largest_contentful_paint: toServerDuration(view.timings.largestContentfulPaint),\n      load_event: toServerDuration(view.timings.loadEvent),\n      loading_time: discardNegativeDuration(toServerDuration(view.loadingTime)),\n      loading_type: view.loadingType,\n      long_task: {\n        count: view.eventCounts.longTaskCount,\n      },\n      resource: {\n        count: view.eventCounts.resourceCount,\n      },\n      time_spent: toServerDuration(view.duration),\n      in_foreground_periods: foregroundContexts.selectInForegroundPeriodsFor(view.startClocks.relative, view.duration),\n    },\n    feature_flags: featureFlagContext && !isEmptyObject(featureFlagContext) ? featureFlagContext : undefined,\n    session: {\n      has_replay: replayStats ? true : undefined,\n    },\n  }\n  if (!isEmptyObject(view.customTimings)) {\n    viewEvent.view.custom_timings = mapValues(\n      view.customTimings,\n      toServerDuration as (duration: Duration) => ServerDuration\n    )\n  }\n  return {\n    rawRumEvent: viewEvent,\n    startTime: view.startClocks.relative,\n    domainContext: {\n      location: view.location,\n    },\n  }\n}\n\nfunction discardNegativeDuration(duration: ServerDuration | undefined): ServerDuration | undefined {\n  return isNumber(duration) && duration < 0 ? undefined : duration\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}