{"ast":null,"code":"import { monitor, ONE_SECOND } from '@datadog/browser-core';\nexport var MAX_DURATION_BETWEEN_CLICKS = ONE_SECOND;\nexport var MAX_DISTANCE_BETWEEN_CLICKS = 100;\nexport function createClickChain(firstClick, onFinalize) {\n  var bufferedClicks = [];\n  var status = 0 /* WaitingForMoreClicks */;\n  var maxDurationBetweenClicksTimeout;\n  appendClick(firstClick);\n  function appendClick(click) {\n    click.stopObservable.subscribe(tryFinalize);\n    bufferedClicks.push(click);\n    clearTimeout(maxDurationBetweenClicksTimeout);\n    maxDurationBetweenClicksTimeout = setTimeout(monitor(dontAcceptMoreClick), MAX_DURATION_BETWEEN_CLICKS);\n  }\n  function tryFinalize() {\n    if (status === 1 /* WaitingForClicksToStop */ && bufferedClicks.every(function (click) {\n      return click.isStopped();\n    })) {\n      status = 2 /* Finalized */;\n      onFinalize(bufferedClicks);\n    }\n  }\n  function dontAcceptMoreClick() {\n    clearTimeout(maxDurationBetweenClicksTimeout);\n    if (status === 0 /* WaitingForMoreClicks */) {\n      status = 1 /* WaitingForClicksToStop */;\n      tryFinalize();\n    }\n  }\n  return {\n    tryAppend: function (click) {\n      if (status !== 0 /* WaitingForMoreClicks */) {\n        return false;\n      }\n      if (bufferedClicks.length > 0 && !areEventsSimilar(bufferedClicks[bufferedClicks.length - 1].event, click.event)) {\n        dontAcceptMoreClick();\n        return false;\n      }\n      appendClick(click);\n      return true;\n    },\n    stop: function () {\n      dontAcceptMoreClick();\n    }\n  };\n}\n/**\n * Checks whether two events are similar by comparing their target, position and timestamp\n */\nfunction areEventsSimilar(first, second) {\n  return first.target === second.target && mouseEventDistance(first, second) <= MAX_DISTANCE_BETWEEN_CLICKS && first.timeStamp - second.timeStamp <= MAX_DURATION_BETWEEN_CLICKS;\n}\nfunction mouseEventDistance(origin, other) {\n  return Math.sqrt(Math.pow(origin.clientX - other.clientX, 2) + Math.pow(origin.clientY - other.clientY, 2));\n}","map":{"version":3,"names":["monitor","ONE_SECOND","MAX_DURATION_BETWEEN_CLICKS","MAX_DISTANCE_BETWEEN_CLICKS","createClickChain","firstClick","onFinalize","bufferedClicks","status","maxDurationBetweenClicksTimeout","appendClick","click","stopObservable","subscribe","tryFinalize","push","clearTimeout","setTimeout","dontAcceptMoreClick","every","isStopped","tryAppend","length","areEventsSimilar","event","stop","first","second","target","mouseEventDistance","timeStamp","origin","other","Math","sqrt","pow","clientX","clientY"],"sources":["/Users/sean.dever/Desktop/PersonalRepos/apm-enablement-sessions/rum_and_trace_correlation/rum_app/node_modules/@datadog/browser-rum-core/src/domain/rumEventsCollection/action/clickChain.ts"],"sourcesContent":["import { monitor, ONE_SECOND } from '@datadog/browser-core'\nimport type { Click } from './trackClickActions'\n\nexport interface ClickChain {\n  tryAppend: (click: Click) => boolean\n  stop: () => void\n}\n\nexport const MAX_DURATION_BETWEEN_CLICKS = ONE_SECOND\nexport const MAX_DISTANCE_BETWEEN_CLICKS = 100\n\nconst enum ClickChainStatus {\n  WaitingForMoreClicks,\n  WaitingForClicksToStop,\n  Finalized,\n}\n\nexport function createClickChain(firstClick: Click, onFinalize: (clicks: Click[]) => void): ClickChain {\n  const bufferedClicks: Click[] = []\n  let status = ClickChainStatus.WaitingForMoreClicks\n  let maxDurationBetweenClicksTimeout: number | undefined\n  appendClick(firstClick)\n\n  function appendClick(click: Click) {\n    click.stopObservable.subscribe(tryFinalize)\n    bufferedClicks.push(click)\n    clearTimeout(maxDurationBetweenClicksTimeout)\n    maxDurationBetweenClicksTimeout = setTimeout(monitor(dontAcceptMoreClick), MAX_DURATION_BETWEEN_CLICKS)\n  }\n\n  function tryFinalize() {\n    if (status === ClickChainStatus.WaitingForClicksToStop && bufferedClicks.every((click) => click.isStopped())) {\n      status = ClickChainStatus.Finalized\n      onFinalize(bufferedClicks)\n    }\n  }\n\n  function dontAcceptMoreClick() {\n    clearTimeout(maxDurationBetweenClicksTimeout)\n    if (status === ClickChainStatus.WaitingForMoreClicks) {\n      status = ClickChainStatus.WaitingForClicksToStop\n      tryFinalize()\n    }\n  }\n\n  return {\n    tryAppend: (click) => {\n      if (status !== ClickChainStatus.WaitingForMoreClicks) {\n        return false\n      }\n\n      if (\n        bufferedClicks.length > 0 &&\n        !areEventsSimilar(bufferedClicks[bufferedClicks.length - 1].event, click.event)\n      ) {\n        dontAcceptMoreClick()\n        return false\n      }\n\n      appendClick(click)\n      return true\n    },\n    stop: () => {\n      dontAcceptMoreClick()\n    },\n  }\n}\n\n/**\n * Checks whether two events are similar by comparing their target, position and timestamp\n */\nfunction areEventsSimilar(first: MouseEvent, second: MouseEvent) {\n  return (\n    first.target === second.target &&\n    mouseEventDistance(first, second) <= MAX_DISTANCE_BETWEEN_CLICKS &&\n    first.timeStamp - second.timeStamp <= MAX_DURATION_BETWEEN_CLICKS\n  )\n}\n\nfunction mouseEventDistance(origin: MouseEvent, other: MouseEvent) {\n  return Math.sqrt(Math.pow(origin.clientX - other.clientX, 2) + Math.pow(origin.clientY - other.clientY, 2))\n}\n"],"mappings":"AAAA,SAASA,OAAO,EAAEC,UAAU,QAAQ,uBAAuB;AAQ3D,OAAO,IAAMC,2BAA2B,GAAGD,UAAU;AACrD,OAAO,IAAME,2BAA2B,GAAG,GAAG;AAQ9C,OAAM,SAAUC,gBAAgBA,CAACC,UAAiB,EAAEC,UAAqC;EACvF,IAAMC,cAAc,GAAY,EAAE;EAClC,IAAIC,MAAM;EACV,IAAIC,+BAAmD;EACvDC,WAAW,CAACL,UAAU,CAAC;EAEvB,SAASK,WAAWA,CAACC,KAAY;IAC/BA,KAAK,CAACC,cAAc,CAACC,SAAS,CAACC,WAAW,CAAC;IAC3CP,cAAc,CAACQ,IAAI,CAACJ,KAAK,CAAC;IAC1BK,YAAY,CAACP,+BAA+B,CAAC;IAC7CA,+BAA+B,GAAGQ,UAAU,CAACjB,OAAO,CAACkB,mBAAmB,CAAC,EAAEhB,2BAA2B,CAAC;EACzG;EAEA,SAASY,WAAWA,CAAA;IAClB,IAAIN,MAAM,uCAAgDD,cAAc,CAACY,KAAK,CAAC,UAACR,KAAK;MAAK,OAAAA,KAAK,CAACS,SAAS,EAAE;IAAjB,CAAiB,CAAC,EAAE;MAC5GZ,MAAM;MACNF,UAAU,CAACC,cAAc,CAAC;;EAE9B;EAEA,SAASW,mBAAmBA,CAAA;IAC1BF,YAAY,CAACP,+BAA+B,CAAC;IAC7C,IAAID,MAAM,mCAA4C;MACpDA,MAAM;MACNM,WAAW,EAAE;;EAEjB;EAEA,OAAO;IACLO,SAAS,EAAE,SAAAA,CAACV,KAAK;MACf,IAAIH,MAAM,mCAA4C;QACpD,OAAO,KAAK;;MAGd,IACED,cAAc,CAACe,MAAM,GAAG,CAAC,IACzB,CAACC,gBAAgB,CAAChB,cAAc,CAACA,cAAc,CAACe,MAAM,GAAG,CAAC,CAAC,CAACE,KAAK,EAAEb,KAAK,CAACa,KAAK,CAAC,EAC/E;QACAN,mBAAmB,EAAE;QACrB,OAAO,KAAK;;MAGdR,WAAW,CAACC,KAAK,CAAC;MAClB,OAAO,IAAI;IACb,CAAC;IACDc,IAAI,EAAE,SAAAA,CAAA;MACJP,mBAAmB,EAAE;IACvB;GACD;AACH;AAEA;;;AAGA,SAASK,gBAAgBA,CAACG,KAAiB,EAAEC,MAAkB;EAC7D,OACED,KAAK,CAACE,MAAM,KAAKD,MAAM,CAACC,MAAM,IAC9BC,kBAAkB,CAACH,KAAK,EAAEC,MAAM,CAAC,IAAIxB,2BAA2B,IAChEuB,KAAK,CAACI,SAAS,GAAGH,MAAM,CAACG,SAAS,IAAI5B,2BAA2B;AAErE;AAEA,SAAS2B,kBAAkBA,CAACE,MAAkB,EAAEC,KAAiB;EAC/D,OAAOC,IAAI,CAACC,IAAI,CAACD,IAAI,CAACE,GAAG,CAACJ,MAAM,CAACK,OAAO,GAAGJ,KAAK,CAACI,OAAO,EAAE,CAAC,CAAC,GAAGH,IAAI,CAACE,GAAG,CAACJ,MAAM,CAACM,OAAO,GAAGL,KAAK,CAACK,OAAO,EAAE,CAAC,CAAC,CAAC;AAC7G"},"metadata":{},"sourceType":"module","externalDependencies":[]}