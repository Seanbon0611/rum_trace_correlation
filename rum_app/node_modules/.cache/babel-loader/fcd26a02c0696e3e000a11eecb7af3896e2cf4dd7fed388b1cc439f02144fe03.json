{"ast":null,"code":"import { noop, assign, combine, toServerDuration, generateUUID } from '@datadog/browser-core';\nimport { trackClickActions } from './trackClickActions';\nexport function startActionCollection(lifeCycle, domMutationObservable, configuration, foregroundContexts) {\n  lifeCycle.subscribe(1 /* AUTO_ACTION_COMPLETED */, function (action) {\n    return lifeCycle.notify(10 /* RAW_RUM_EVENT_COLLECTED */, processAction(action, foregroundContexts));\n  });\n  var actionContexts = {\n    findActionId: noop\n  };\n  if (configuration.trackUserInteractions) {\n    actionContexts = trackClickActions(lifeCycle, domMutationObservable, configuration).actionContexts;\n  }\n  return {\n    addAction: function (action, savedCommonContext) {\n      lifeCycle.notify(10 /* RAW_RUM_EVENT_COLLECTED */, assign({\n        savedCommonContext: savedCommonContext\n      }, processAction(action, foregroundContexts)));\n    },\n    actionContexts: actionContexts\n  };\n}\nfunction processAction(action, foregroundContexts) {\n  var autoActionProperties = isAutoAction(action) ? {\n    action: {\n      id: action.id,\n      loading_time: toServerDuration(action.duration),\n      frustration: {\n        type: action.frustrationTypes\n      },\n      error: {\n        count: action.counts.errorCount\n      },\n      long_task: {\n        count: action.counts.longTaskCount\n      },\n      resource: {\n        count: action.counts.resourceCount\n      }\n    },\n    _dd: {\n      action: {\n        target: action.target,\n        position: action.position\n      }\n    }\n  } : undefined;\n  var customerContext = !isAutoAction(action) ? action.context : undefined;\n  var actionEvent = combine({\n    action: {\n      id: generateUUID(),\n      target: {\n        name: action.name\n      },\n      type: action.type\n    },\n    date: action.startClocks.timeStamp,\n    type: \"action\" /* ACTION */\n  }, autoActionProperties);\n  var inForeground = foregroundContexts.isInForegroundAt(action.startClocks.relative);\n  if (inForeground !== undefined) {\n    actionEvent.view = {\n      in_foreground: inForeground\n    };\n  }\n  return {\n    customerContext: customerContext,\n    rawRumEvent: actionEvent,\n    startTime: action.startClocks.relative,\n    domainContext: isAutoAction(action) ? {\n      event: action.event,\n      events: action.events\n    } : {}\n  };\n}\nfunction isAutoAction(action) {\n  return action.type !== \"custom\" /* CUSTOM */;\n}","map":{"version":3,"names":["noop","assign","combine","toServerDuration","generateUUID","trackClickActions","startActionCollection","lifeCycle","domMutationObservable","configuration","foregroundContexts","subscribe","action","notify","processAction","actionContexts","findActionId","trackUserInteractions","addAction","savedCommonContext","autoActionProperties","isAutoAction","id","loading_time","duration","frustration","type","frustrationTypes","error","count","counts","errorCount","long_task","longTaskCount","resource","resourceCount","_dd","target","position","undefined","customerContext","context","actionEvent","name","date","startClocks","timeStamp","inForeground","isInForegroundAt","relative","view","in_foreground","rawRumEvent","startTime","domainContext","event","events"],"sources":["/Users/sean.dever/Desktop/PersonalRepos/rum_and_trace_correlation/rum_app/node_modules/@datadog/browser-rum-core/src/domain/rumEventsCollection/action/actionCollection.ts"],"sourcesContent":["import type { ClocksState, Context, Observable } from '@datadog/browser-core'\nimport { noop, assign, combine, toServerDuration, generateUUID } from '@datadog/browser-core'\n\nimport type { RawRumActionEvent } from '../../../rawRumEvent.types'\nimport { ActionType, RumEventType } from '../../../rawRumEvent.types'\nimport type { LifeCycle, RawRumEventCollectedData } from '../../lifeCycle'\nimport { LifeCycleEventType } from '../../lifeCycle'\nimport type { ForegroundContexts } from '../../contexts/foregroundContexts'\nimport type { RumConfiguration } from '../../configuration'\nimport type { CommonContext } from '../../contexts/commonContext'\nimport type { ActionContexts, ClickAction } from './trackClickActions'\nimport { trackClickActions } from './trackClickActions'\n\nexport type { ActionContexts }\n\nexport interface CustomAction {\n  type: ActionType.CUSTOM\n  name: string\n  startClocks: ClocksState\n  context?: Context\n}\n\nexport type AutoAction = ClickAction\n\nexport function startActionCollection(\n  lifeCycle: LifeCycle,\n  domMutationObservable: Observable<void>,\n  configuration: RumConfiguration,\n  foregroundContexts: ForegroundContexts\n) {\n  lifeCycle.subscribe(LifeCycleEventType.AUTO_ACTION_COMPLETED, (action) =>\n    lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, processAction(action, foregroundContexts))\n  )\n\n  let actionContexts: ActionContexts = { findActionId: noop as () => undefined }\n  if (configuration.trackUserInteractions) {\n    actionContexts = trackClickActions(lifeCycle, domMutationObservable, configuration).actionContexts\n  }\n\n  return {\n    addAction: (action: CustomAction, savedCommonContext?: CommonContext) => {\n      lifeCycle.notify(\n        LifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n        assign(\n          {\n            savedCommonContext,\n          },\n          processAction(action, foregroundContexts)\n        )\n      )\n    },\n    actionContexts,\n  }\n}\n\nfunction processAction(\n  action: AutoAction | CustomAction,\n  foregroundContexts: ForegroundContexts\n): RawRumEventCollectedData<RawRumActionEvent> {\n  const autoActionProperties = isAutoAction(action)\n    ? {\n        action: {\n          id: action.id,\n          loading_time: toServerDuration(action.duration),\n          frustration: {\n            type: action.frustrationTypes,\n          },\n          error: {\n            count: action.counts.errorCount,\n          },\n          long_task: {\n            count: action.counts.longTaskCount,\n          },\n          resource: {\n            count: action.counts.resourceCount,\n          },\n        },\n        _dd: {\n          action: {\n            target: action.target,\n            position: action.position,\n          },\n        },\n      }\n    : undefined\n  const customerContext = !isAutoAction(action) ? action.context : undefined\n  const actionEvent: RawRumActionEvent = combine(\n    {\n      action: {\n        id: generateUUID(),\n        target: {\n          name: action.name,\n        },\n        type: action.type,\n      },\n      date: action.startClocks.timeStamp,\n      type: RumEventType.ACTION as const,\n    },\n    autoActionProperties\n  )\n  const inForeground = foregroundContexts.isInForegroundAt(action.startClocks.relative)\n  if (inForeground !== undefined) {\n    actionEvent.view = { in_foreground: inForeground }\n  }\n  return {\n    customerContext,\n    rawRumEvent: actionEvent,\n    startTime: action.startClocks.relative,\n    domainContext: isAutoAction(action) ? { event: action.event, events: action.events } : {},\n  }\n}\n\nfunction isAutoAction(action: AutoAction | CustomAction): action is AutoAction {\n  return action.type !== ActionType.CUSTOM\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}