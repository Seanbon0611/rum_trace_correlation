{"ast":null,"code":"var _a;\nimport { instrumentSetter, instrumentMethodAndCallOriginal, assign, monitor, throttle, addEventListeners, addEventListener, noop, addTelemetryDebug } from '@datadog/browser-core';\nimport { isNodeShadowHost, initViewportObservable } from '@datadog/browser-rum-core';\nimport { NodePrivacyLevel } from '../../constants';\nimport { RecordType, IncrementalSource, MediaInteractionType, MouseInteractionType } from '../../types';\nimport { getNodePrivacyLevel, shouldMaskNode } from './privacy';\nimport { getElementInputValue, getSerializedNodeId, hasSerializedNode } from './serializationUtils';\nimport { assembleIncrementalSnapshot, forEach, getPathToNestedCSSRule, isTouchEvent } from './utils';\nimport { startMutationObserver } from './mutationObserver';\nimport { getVisualViewport, getScrollX, getScrollY, convertMouseEventToLayoutCoordinates } from './viewports';\nvar MOUSE_MOVE_OBSERVER_THRESHOLD = 50;\nvar SCROLL_OBSERVER_THRESHOLD = 100;\nvar VISUAL_VIEWPORT_OBSERVER_THRESHOLD = 200;\nvar recordIds = new WeakMap();\nvar nextId = 1;\nexport function getRecordIdForEvent(event) {\n  if (!recordIds.has(event)) {\n    recordIds.set(event, nextId++);\n  }\n  return recordIds.get(event);\n}\nexport function initObservers(o) {\n  var mutationHandler = initMutationObserver(o.mutationCb, o.configuration, o.shadowRootsController);\n  var mousemoveHandler = initMoveObserver(o.mousemoveCb);\n  var mouseInteractionHandler = initMouseInteractionObserver(o.mouseInteractionCb, o.configuration.defaultPrivacyLevel);\n  var scrollHandler = initScrollObserver(o.scrollCb, o.configuration.defaultPrivacyLevel, o.elementsScrollPositions);\n  var viewportResizeHandler = initViewportResizeObserver(o.viewportResizeCb);\n  var inputHandler = initInputObserver(o.inputCb, o.configuration.defaultPrivacyLevel);\n  var mediaInteractionHandler = initMediaInteractionObserver(o.mediaInteractionCb, o.configuration.defaultPrivacyLevel);\n  var styleSheetObserver = initStyleSheetObserver(o.styleSheetCb);\n  var focusHandler = initFocusObserver(o.focusCb);\n  var visualViewportResizeHandler = initVisualViewportResizeObserver(o.visualViewportResizeCb);\n  var frustrationHandler = initFrustrationObserver(o.lifeCycle, o.frustrationCb);\n  return {\n    flush: function () {\n      mutationHandler.flush();\n    },\n    stop: function () {\n      mutationHandler.stop();\n      mousemoveHandler();\n      mouseInteractionHandler();\n      scrollHandler();\n      viewportResizeHandler();\n      inputHandler();\n      mediaInteractionHandler();\n      styleSheetObserver();\n      focusHandler();\n      visualViewportResizeHandler();\n      frustrationHandler();\n    }\n  };\n}\nexport function initMutationObserver(cb, configuration, shadowRootsController) {\n  return startMutationObserver(cb, configuration, shadowRootsController, document);\n}\nexport function initMoveObserver(cb) {\n  var updatePosition = throttle(monitor(function (event) {\n    var target = getEventTarget(event);\n    if (hasSerializedNode(target)) {\n      var coordinates = tryToComputeCoordinates(event);\n      if (!coordinates) {\n        return;\n      }\n      var position = {\n        id: getSerializedNodeId(target),\n        timeOffset: 0,\n        x: coordinates.x,\n        y: coordinates.y\n      };\n      cb([position], isTouchEvent(event) ? IncrementalSource.TouchMove : IncrementalSource.MouseMove);\n    }\n  }), MOUSE_MOVE_OBSERVER_THRESHOLD, {\n    trailing: false\n  }).throttled;\n  return addEventListeners(document, [\"mousemove\" /* MOUSE_MOVE */, \"touchmove\" /* TOUCH_MOVE */], updatePosition, {\n    capture: true,\n    passive: true\n  }).stop;\n}\nvar eventTypeToMouseInteraction = (_a = {},\n// Listen for pointerup DOM events instead of mouseup for MouseInteraction/MouseUp records. This\n// allows to reference such records from Frustration records.\n//\n// In the context of supporting Mobile Session Replay, we introduced `PointerInteraction` records\n// used by the Mobile SDKs in place of `MouseInteraction`. In the future, we should replace\n// `MouseInteraction` by `PointerInteraction` in the Browser SDK so we have an uniform way to\n// convey such interaction. This would cleanly solve the issue since we would have\n// `PointerInteraction/Up` records that we could reference from `Frustration` records.\n_a[\"pointerup\" /* POINTER_UP */] = MouseInteractionType.MouseUp, _a[\"mousedown\" /* MOUSE_DOWN */] = MouseInteractionType.MouseDown, _a[\"click\" /* CLICK */] = MouseInteractionType.Click, _a[\"contextmenu\" /* CONTEXT_MENU */] = MouseInteractionType.ContextMenu, _a[\"dblclick\" /* DBL_CLICK */] = MouseInteractionType.DblClick, _a[\"focus\" /* FOCUS */] = MouseInteractionType.Focus, _a[\"blur\" /* BLUR */] = MouseInteractionType.Blur, _a[\"touchstart\" /* TOUCH_START */] = MouseInteractionType.TouchStart, _a[\"touchend\" /* TOUCH_END */] = MouseInteractionType.TouchEnd, _a);\nexport function initMouseInteractionObserver(cb, defaultPrivacyLevel) {\n  var handler = function (event) {\n    var target = getEventTarget(event);\n    if (getNodePrivacyLevel(target, defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN || !hasSerializedNode(target)) {\n      return;\n    }\n    var id = getSerializedNodeId(target);\n    var type = eventTypeToMouseInteraction[event.type];\n    var interaction;\n    if (type !== MouseInteractionType.Blur && type !== MouseInteractionType.Focus) {\n      var coordinates = tryToComputeCoordinates(event);\n      if (!coordinates) {\n        return;\n      }\n      interaction = {\n        id: id,\n        type: type,\n        x: coordinates.x,\n        y: coordinates.y\n      };\n    } else {\n      interaction = {\n        id: id,\n        type: type\n      };\n    }\n    var record = assign({\n      id: getRecordIdForEvent(event)\n    }, assembleIncrementalSnapshot(IncrementalSource.MouseInteraction, interaction));\n    cb(record);\n  };\n  return addEventListeners(document, Object.keys(eventTypeToMouseInteraction), handler, {\n    capture: true,\n    passive: true\n  }).stop;\n}\nfunction tryToComputeCoordinates(event) {\n  var _a = isTouchEvent(event) ? event.changedTouches[0] : event,\n    x = _a.clientX,\n    y = _a.clientY;\n  if (window.visualViewport) {\n    var _b = convertMouseEventToLayoutCoordinates(x, y),\n      visualViewportX = _b.visualViewportX,\n      visualViewportY = _b.visualViewportY;\n    x = visualViewportX;\n    y = visualViewportY;\n  }\n  if (!Number.isFinite(x) || !Number.isFinite(y)) {\n    if (event.isTrusted) {\n      addTelemetryDebug('mouse/touch event without x/y');\n    }\n    return undefined;\n  }\n  return {\n    x: x,\n    y: y\n  };\n}\nfunction initScrollObserver(cb, defaultPrivacyLevel, elementsScrollPositions) {\n  var updatePosition = throttle(monitor(function (event) {\n    var target = getEventTarget(event);\n    if (!target || getNodePrivacyLevel(target, defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN || !hasSerializedNode(target)) {\n      return;\n    }\n    var id = getSerializedNodeId(target);\n    var scrollPositions = target === document ? {\n      scrollTop: getScrollY(),\n      scrollLeft: getScrollX()\n    } : {\n      scrollTop: Math.round(target.scrollTop),\n      scrollLeft: Math.round(target.scrollLeft)\n    };\n    elementsScrollPositions.set(target, scrollPositions);\n    cb({\n      id: id,\n      x: scrollPositions.scrollLeft,\n      y: scrollPositions.scrollTop\n    });\n  }), SCROLL_OBSERVER_THRESHOLD).throttled;\n  return addEventListener(document, \"scroll\" /* SCROLL */, updatePosition, {\n    capture: true,\n    passive: true\n  }).stop;\n}\nfunction initViewportResizeObserver(cb) {\n  return initViewportObservable().subscribe(cb).unsubscribe;\n}\nexport function initInputObserver(cb, defaultPrivacyLevel, _a) {\n  var _b = _a === void 0 ? {} : _a,\n    _c = _b.domEvents,\n    domEvents = _c === void 0 ? [\"input\" /* INPUT */, \"change\" /* CHANGE */] : _c,\n    _d = _b.target,\n    target = _d === void 0 ? document : _d;\n  var lastInputStateMap = new WeakMap();\n  function onElementChange(target) {\n    var nodePrivacyLevel = getNodePrivacyLevel(target, defaultPrivacyLevel);\n    if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {\n      return;\n    }\n    var type = target.type;\n    var inputState;\n    if (type === 'radio' || type === 'checkbox') {\n      if (shouldMaskNode(target, nodePrivacyLevel)) {\n        return;\n      }\n      inputState = {\n        isChecked: target.checked\n      };\n    } else {\n      var value = getElementInputValue(target, nodePrivacyLevel);\n      if (value === undefined) {\n        return;\n      }\n      inputState = {\n        text: value\n      };\n    }\n    // Can be multiple changes on the same node within the same batched mutation observation.\n    cbWithDedup(target, inputState);\n    // If a radio was checked, other radios with the same name attribute will be unchecked.\n    var name = target.name;\n    if (type === 'radio' && name && target.checked) {\n      forEach(document.querySelectorAll(\"input[type=\\\"radio\\\"][name=\\\"\".concat(name, \"\\\"]\")), function (el) {\n        if (el !== target) {\n          // TODO: Consider the privacy implications for various differing input privacy levels\n          cbWithDedup(el, {\n            isChecked: false\n          });\n        }\n      });\n    }\n  }\n  /**\n   * There can be multiple changes on the same node within the same batched mutation observation.\n   */\n  function cbWithDedup(target, inputState) {\n    if (!hasSerializedNode(target)) {\n      return;\n    }\n    var lastInputState = lastInputStateMap.get(target);\n    if (!lastInputState || lastInputState.text !== inputState.text || lastInputState.isChecked !== inputState.isChecked) {\n      lastInputStateMap.set(target, inputState);\n      cb(assign({\n        id: getSerializedNodeId(target)\n      }, inputState));\n    }\n  }\n  var stopEventListeners = addEventListeners(target, domEvents, function (event) {\n    var target = getEventTarget(event);\n    if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement || target instanceof HTMLSelectElement) {\n      onElementChange(target);\n    }\n  }, {\n    capture: true,\n    passive: true\n  }).stop;\n  var instrumentationStoppers = [instrumentSetter(HTMLInputElement.prototype, 'value', onElementChange), instrumentSetter(HTMLInputElement.prototype, 'checked', onElementChange), instrumentSetter(HTMLSelectElement.prototype, 'value', onElementChange), instrumentSetter(HTMLTextAreaElement.prototype, 'value', onElementChange), instrumentSetter(HTMLSelectElement.prototype, 'selectedIndex', onElementChange)];\n  return function () {\n    instrumentationStoppers.forEach(function (stopper) {\n      return stopper.stop();\n    });\n    stopEventListeners();\n  };\n}\nexport function initStyleSheetObserver(cb) {\n  function checkStyleSheetAndCallback(styleSheet, callback) {\n    if (styleSheet && hasSerializedNode(styleSheet.ownerNode)) {\n      callback(getSerializedNodeId(styleSheet.ownerNode));\n    }\n  }\n  var instrumentationStoppers = [instrumentMethodAndCallOriginal(CSSStyleSheet.prototype, 'insertRule', {\n    before: function (rule, index) {\n      checkStyleSheetAndCallback(this, function (id) {\n        return cb({\n          id: id,\n          adds: [{\n            rule: rule,\n            index: index\n          }]\n        });\n      });\n    }\n  }), instrumentMethodAndCallOriginal(CSSStyleSheet.prototype, 'deleteRule', {\n    before: function (index) {\n      checkStyleSheetAndCallback(this, function (id) {\n        return cb({\n          id: id,\n          removes: [{\n            index: index\n          }]\n        });\n      });\n    }\n  })];\n  if (typeof CSSGroupingRule !== 'undefined') {\n    instrumentGroupingCSSRuleClass(CSSGroupingRule);\n  } else {\n    instrumentGroupingCSSRuleClass(CSSMediaRule);\n    instrumentGroupingCSSRuleClass(CSSSupportsRule);\n  }\n  function instrumentGroupingCSSRuleClass(cls) {\n    instrumentationStoppers.push(instrumentMethodAndCallOriginal(cls.prototype, 'insertRule', {\n      before: function (rule, index) {\n        var _this = this;\n        checkStyleSheetAndCallback(this.parentStyleSheet, function (id) {\n          var path = getPathToNestedCSSRule(_this);\n          if (path) {\n            path.push(index || 0);\n            cb({\n              id: id,\n              adds: [{\n                rule: rule,\n                index: path\n              }]\n            });\n          }\n        });\n      }\n    }), instrumentMethodAndCallOriginal(cls.prototype, 'deleteRule', {\n      before: function (index) {\n        var _this = this;\n        checkStyleSheetAndCallback(this.parentStyleSheet, function (id) {\n          var path = getPathToNestedCSSRule(_this);\n          if (path) {\n            path.push(index);\n            cb({\n              id: id,\n              removes: [{\n                index: path\n              }]\n            });\n          }\n        });\n      }\n    }));\n  }\n  return function () {\n    return instrumentationStoppers.forEach(function (stopper) {\n      return stopper.stop();\n    });\n  };\n}\nfunction initMediaInteractionObserver(mediaInteractionCb, defaultPrivacyLevel) {\n  var handler = function (event) {\n    var target = getEventTarget(event);\n    if (!target || getNodePrivacyLevel(target, defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN || !hasSerializedNode(target)) {\n      return;\n    }\n    mediaInteractionCb({\n      id: getSerializedNodeId(target),\n      type: event.type === \"play\" /* PLAY */ ? MediaInteractionType.Play : MediaInteractionType.Pause\n    });\n  };\n  return addEventListeners(document, [\"play\" /* PLAY */, \"pause\" /* PAUSE */], handler, {\n    capture: true,\n    passive: true\n  }).stop;\n}\nfunction initFocusObserver(focusCb) {\n  return addEventListeners(window, [\"focus\" /* FOCUS */, \"blur\" /* BLUR */], function () {\n    focusCb({\n      has_focus: document.hasFocus()\n    });\n  }).stop;\n}\nfunction initVisualViewportResizeObserver(cb) {\n  if (!window.visualViewport) {\n    return noop;\n  }\n  var _a = throttle(monitor(function () {\n      cb(getVisualViewport());\n    }), VISUAL_VIEWPORT_OBSERVER_THRESHOLD, {\n      trailing: false\n    }),\n    updateDimension = _a.throttled,\n    cancelThrottle = _a.cancel;\n  var removeListener = addEventListeners(window.visualViewport, [\"resize\" /* RESIZE */, \"scroll\" /* SCROLL */], updateDimension, {\n    capture: true,\n    passive: true\n  }).stop;\n  return function stop() {\n    removeListener();\n    cancelThrottle();\n  };\n}\nexport function initFrustrationObserver(lifeCycle, frustrationCb) {\n  return lifeCycle.subscribe(10 /* RAW_RUM_EVENT_COLLECTED */, function (data) {\n    var _a, _b, _c;\n    if (data.rawRumEvent.type === \"action\" /* ACTION */ && data.rawRumEvent.action.type === \"click\" /* CLICK */ && ((_b = (_a = data.rawRumEvent.action.frustration) === null || _a === void 0 ? void 0 : _a.type) === null || _b === void 0 ? void 0 : _b.length) && 'events' in data.domainContext && ((_c = data.domainContext.events) === null || _c === void 0 ? void 0 : _c.length)) {\n      frustrationCb({\n        timestamp: data.rawRumEvent.date,\n        type: RecordType.FrustrationRecord,\n        data: {\n          frustrationTypes: data.rawRumEvent.action.frustration.type,\n          recordIds: data.domainContext.events.map(function (e) {\n            return getRecordIdForEvent(e);\n          })\n        }\n      });\n    }\n  }).unsubscribe;\n}\nfunction getEventTarget(event) {\n  if (event.composed === true && isNodeShadowHost(event.target)) {\n    return event.composedPath()[0];\n  }\n  return event.target;\n}","map":{"version":3,"names":["instrumentSetter","instrumentMethodAndCallOriginal","assign","monitor","throttle","addEventListeners","addEventListener","noop","addTelemetryDebug","isNodeShadowHost","initViewportObservable","NodePrivacyLevel","RecordType","IncrementalSource","MediaInteractionType","MouseInteractionType","getNodePrivacyLevel","shouldMaskNode","getElementInputValue","getSerializedNodeId","hasSerializedNode","assembleIncrementalSnapshot","forEach","getPathToNestedCSSRule","isTouchEvent","startMutationObserver","getVisualViewport","getScrollX","getScrollY","convertMouseEventToLayoutCoordinates","MOUSE_MOVE_OBSERVER_THRESHOLD","SCROLL_OBSERVER_THRESHOLD","VISUAL_VIEWPORT_OBSERVER_THRESHOLD","recordIds","WeakMap","nextId","getRecordIdForEvent","event","has","set","get","initObservers","o","mutationHandler","initMutationObserver","mutationCb","configuration","shadowRootsController","mousemoveHandler","initMoveObserver","mousemoveCb","mouseInteractionHandler","initMouseInteractionObserver","mouseInteractionCb","defaultPrivacyLevel","scrollHandler","initScrollObserver","scrollCb","elementsScrollPositions","viewportResizeHandler","initViewportResizeObserver","viewportResizeCb","inputHandler","initInputObserver","inputCb","mediaInteractionHandler","initMediaInteractionObserver","mediaInteractionCb","styleSheetObserver","initStyleSheetObserver","styleSheetCb","focusHandler","initFocusObserver","focusCb","visualViewportResizeHandler","initVisualViewportResizeObserver","visualViewportResizeCb","frustrationHandler","initFrustrationObserver","lifeCycle","frustrationCb","flush","stop","cb","document","updatePosition","target","getEventTarget","coordinates","tryToComputeCoordinates","position","id","timeOffset","x","y","TouchMove","MouseMove","trailing","throttled","capture","passive","eventTypeToMouseInteraction","_a","MouseUp","MouseDown","Click","ContextMenu","DblClick","Focus","Blur","TouchStart","TouchEnd","handler","HIDDEN","type","interaction","record","MouseInteraction","Object","keys","changedTouches","clientX","clientY","window","visualViewport","_b","visualViewportX","visualViewportY","Number","isFinite","isTrusted","undefined","scrollPositions","scrollTop","scrollLeft","Math","round","subscribe","unsubscribe","_c","domEvents","_d","lastInputStateMap","onElementChange","nodePrivacyLevel","inputState","isChecked","checked","value","text","cbWithDedup","name","querySelectorAll","concat","el","lastInputState","stopEventListeners","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","instrumentationStoppers","prototype","stopper","checkStyleSheetAndCallback","styleSheet","callback","ownerNode","CSSStyleSheet","before","rule","index","adds","removes","CSSGroupingRule","instrumentGroupingCSSRuleClass","CSSMediaRule","CSSSupportsRule","cls","push","_this","parentStyleSheet","path","Play","Pause","has_focus","hasFocus","updateDimension","cancelThrottle","cancel","removeListener","data","rawRumEvent","action","frustration","length","domainContext","events","timestamp","date","FrustrationRecord","frustrationTypes","map","e","composed","composedPath"],"sources":["/Users/sean.dever/Desktop/PersonalRepos/apm-enablement-sessions/rum_and_trace_correlation/rum_app/node_modules/@datadog/browser-rum/src/domain/record/observers.ts"],"sourcesContent":["import type { DefaultPrivacyLevel } from '@datadog/browser-core'\nimport {\n  instrumentSetter,\n  instrumentMethodAndCallOriginal,\n  assign,\n  monitor,\n  throttle,\n  DOM_EVENT,\n  addEventListeners,\n  addEventListener,\n  noop,\n  addTelemetryDebug,\n} from '@datadog/browser-core'\nimport type { LifeCycle, RumConfiguration } from '@datadog/browser-rum-core'\nimport {\n  isNodeShadowHost,\n  initViewportObservable,\n  ActionType,\n  RumEventType,\n  LifeCycleEventType,\n} from '@datadog/browser-rum-core'\nimport { NodePrivacyLevel } from '../../constants'\nimport type {\n  InputState,\n  MousePosition,\n  MouseInteraction,\n  BrowserMutationPayload,\n  ScrollPosition,\n  StyleSheetRule,\n  ViewportResizeDimension,\n  MediaInteraction,\n  FocusRecord,\n  VisualViewportRecord,\n  FrustrationRecord,\n  BrowserIncrementalSnapshotRecord,\n  MouseInteractionData,\n} from '../../types'\nimport { RecordType, IncrementalSource, MediaInteractionType, MouseInteractionType } from '../../types'\nimport { getNodePrivacyLevel, shouldMaskNode } from './privacy'\nimport { getElementInputValue, getSerializedNodeId, hasSerializedNode } from './serializationUtils'\nimport { assembleIncrementalSnapshot, forEach, getPathToNestedCSSRule, isTouchEvent } from './utils'\nimport { startMutationObserver } from './mutationObserver'\nimport { getVisualViewport, getScrollX, getScrollY, convertMouseEventToLayoutCoordinates } from './viewports'\nimport type { ElementsScrollPositions } from './elementsScrollPositions'\nimport type { ShadowRootsController } from './shadowRootsController'\n\nconst MOUSE_MOVE_OBSERVER_THRESHOLD = 50\nconst SCROLL_OBSERVER_THRESHOLD = 100\nconst VISUAL_VIEWPORT_OBSERVER_THRESHOLD = 200\n\nconst recordIds = new WeakMap<Event, number>()\nlet nextId = 1\n\nexport function getRecordIdForEvent(event: Event): number {\n  if (!recordIds.has(event)) {\n    recordIds.set(event, nextId++)\n  }\n  return recordIds.get(event)!\n}\n\ntype GroupingCSSRuleTypes = typeof CSSGroupingRule | typeof CSSMediaRule | typeof CSSSupportsRule\n\ntype ListenerHandler = () => void\n\nexport type MousemoveCallBack = (\n  p: MousePosition[],\n  source: typeof IncrementalSource.MouseMove | typeof IncrementalSource.TouchMove\n) => void\n\nexport type MutationCallBack = (m: BrowserMutationPayload) => void\n\nexport type MouseInteractionCallBack = (record: BrowserIncrementalSnapshotRecord) => void\n\ntype ScrollCallback = (p: ScrollPosition) => void\n\nexport type StyleSheetCallback = (s: StyleSheetRule) => void\n\ntype ViewportResizeCallback = (d: ViewportResizeDimension) => void\n\nexport type InputCallback = (v: InputState & { id: number }) => void\n\ntype MediaInteractionCallback = (p: MediaInteraction) => void\n\ntype FocusCallback = (data: FocusRecord['data']) => void\n\ntype VisualViewportResizeCallback = (data: VisualViewportRecord['data']) => void\n\nexport type FrustrationCallback = (record: FrustrationRecord) => void\n\ninterface ObserverParam {\n  lifeCycle: LifeCycle\n  configuration: RumConfiguration\n  elementsScrollPositions: ElementsScrollPositions\n  mutationCb: MutationCallBack\n  mousemoveCb: MousemoveCallBack\n  mouseInteractionCb: MouseInteractionCallBack\n  scrollCb: ScrollCallback\n  viewportResizeCb: ViewportResizeCallback\n  visualViewportResizeCb: VisualViewportResizeCallback\n  inputCb: InputCallback\n  mediaInteractionCb: MediaInteractionCallback\n  styleSheetCb: StyleSheetCallback\n  focusCb: FocusCallback\n  frustrationCb: FrustrationCallback\n  shadowRootsController: ShadowRootsController\n}\n\nexport function initObservers(o: ObserverParam): { stop: ListenerHandler; flush: ListenerHandler } {\n  const mutationHandler = initMutationObserver(o.mutationCb, o.configuration, o.shadowRootsController)\n  const mousemoveHandler = initMoveObserver(o.mousemoveCb)\n  const mouseInteractionHandler = initMouseInteractionObserver(\n    o.mouseInteractionCb,\n    o.configuration.defaultPrivacyLevel\n  )\n  const scrollHandler = initScrollObserver(o.scrollCb, o.configuration.defaultPrivacyLevel, o.elementsScrollPositions)\n  const viewportResizeHandler = initViewportResizeObserver(o.viewportResizeCb)\n  const inputHandler = initInputObserver(o.inputCb, o.configuration.defaultPrivacyLevel)\n  const mediaInteractionHandler = initMediaInteractionObserver(\n    o.mediaInteractionCb,\n    o.configuration.defaultPrivacyLevel\n  )\n  const styleSheetObserver = initStyleSheetObserver(o.styleSheetCb)\n  const focusHandler = initFocusObserver(o.focusCb)\n  const visualViewportResizeHandler = initVisualViewportResizeObserver(o.visualViewportResizeCb)\n  const frustrationHandler = initFrustrationObserver(o.lifeCycle, o.frustrationCb)\n\n  return {\n    flush: () => {\n      mutationHandler.flush()\n    },\n    stop: () => {\n      mutationHandler.stop()\n      mousemoveHandler()\n      mouseInteractionHandler()\n      scrollHandler()\n      viewportResizeHandler()\n      inputHandler()\n      mediaInteractionHandler()\n      styleSheetObserver()\n      focusHandler()\n      visualViewportResizeHandler()\n      frustrationHandler()\n    },\n  }\n}\n\nexport function initMutationObserver(\n  cb: MutationCallBack,\n  configuration: RumConfiguration,\n  shadowRootsController: ShadowRootsController\n) {\n  return startMutationObserver(cb, configuration, shadowRootsController, document)\n}\n\nexport function initMoveObserver(cb: MousemoveCallBack): ListenerHandler {\n  const { throttled: updatePosition } = throttle(\n    monitor((event: MouseEvent | TouchEvent) => {\n      const target = getEventTarget(event)\n      if (hasSerializedNode(target)) {\n        const coordinates = tryToComputeCoordinates(event)\n        if (!coordinates) {\n          return\n        }\n        const position: MousePosition = {\n          id: getSerializedNodeId(target),\n          timeOffset: 0,\n          x: coordinates.x,\n          y: coordinates.y,\n        }\n\n        cb([position], isTouchEvent(event) ? IncrementalSource.TouchMove : IncrementalSource.MouseMove)\n      }\n    }),\n    MOUSE_MOVE_OBSERVER_THRESHOLD,\n    {\n      trailing: false,\n    }\n  )\n\n  return addEventListeners(document, [DOM_EVENT.MOUSE_MOVE, DOM_EVENT.TOUCH_MOVE], updatePosition, {\n    capture: true,\n    passive: true,\n  }).stop\n}\n\nconst eventTypeToMouseInteraction = {\n  // Listen for pointerup DOM events instead of mouseup for MouseInteraction/MouseUp records. This\n  // allows to reference such records from Frustration records.\n  //\n  // In the context of supporting Mobile Session Replay, we introduced `PointerInteraction` records\n  // used by the Mobile SDKs in place of `MouseInteraction`. In the future, we should replace\n  // `MouseInteraction` by `PointerInteraction` in the Browser SDK so we have an uniform way to\n  // convey such interaction. This would cleanly solve the issue since we would have\n  // `PointerInteraction/Up` records that we could reference from `Frustration` records.\n  [DOM_EVENT.POINTER_UP]: MouseInteractionType.MouseUp,\n\n  [DOM_EVENT.MOUSE_DOWN]: MouseInteractionType.MouseDown,\n  [DOM_EVENT.CLICK]: MouseInteractionType.Click,\n  [DOM_EVENT.CONTEXT_MENU]: MouseInteractionType.ContextMenu,\n  [DOM_EVENT.DBL_CLICK]: MouseInteractionType.DblClick,\n  [DOM_EVENT.FOCUS]: MouseInteractionType.Focus,\n  [DOM_EVENT.BLUR]: MouseInteractionType.Blur,\n  [DOM_EVENT.TOUCH_START]: MouseInteractionType.TouchStart,\n  [DOM_EVENT.TOUCH_END]: MouseInteractionType.TouchEnd,\n}\nexport function initMouseInteractionObserver(\n  cb: MouseInteractionCallBack,\n  defaultPrivacyLevel: DefaultPrivacyLevel\n): ListenerHandler {\n  const handler = (event: MouseEvent | TouchEvent) => {\n    const target = getEventTarget(event)\n    if (getNodePrivacyLevel(target, defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN || !hasSerializedNode(target)) {\n      return\n    }\n    const id = getSerializedNodeId(target)\n    const type = eventTypeToMouseInteraction[event.type as keyof typeof eventTypeToMouseInteraction]\n\n    let interaction: MouseInteraction\n    if (type !== MouseInteractionType.Blur && type !== MouseInteractionType.Focus) {\n      const coordinates = tryToComputeCoordinates(event)\n      if (!coordinates) {\n        return\n      }\n      interaction = { id, type, x: coordinates.x, y: coordinates.y }\n    } else {\n      interaction = { id, type }\n    }\n\n    const record = assign(\n      { id: getRecordIdForEvent(event) },\n      assembleIncrementalSnapshot<MouseInteractionData>(IncrementalSource.MouseInteraction, interaction)\n    )\n    cb(record)\n  }\n  return addEventListeners(document, Object.keys(eventTypeToMouseInteraction) as DOM_EVENT[], handler, {\n    capture: true,\n    passive: true,\n  }).stop\n}\n\nfunction tryToComputeCoordinates(event: MouseEvent | TouchEvent) {\n  let { clientX: x, clientY: y } = isTouchEvent(event) ? event.changedTouches[0] : event\n  if (window.visualViewport) {\n    const { visualViewportX, visualViewportY } = convertMouseEventToLayoutCoordinates(x, y)\n    x = visualViewportX\n    y = visualViewportY\n  }\n  if (!Number.isFinite(x) || !Number.isFinite(y)) {\n    if (event.isTrusted) {\n      addTelemetryDebug('mouse/touch event without x/y')\n    }\n    return undefined\n  }\n  return { x, y }\n}\n\nfunction initScrollObserver(\n  cb: ScrollCallback,\n  defaultPrivacyLevel: DefaultPrivacyLevel,\n  elementsScrollPositions: ElementsScrollPositions\n): ListenerHandler {\n  const { throttled: updatePosition } = throttle(\n    monitor((event: UIEvent) => {\n      const target = getEventTarget(event) as HTMLElement | Document\n      if (\n        !target ||\n        getNodePrivacyLevel(target, defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN ||\n        !hasSerializedNode(target)\n      ) {\n        return\n      }\n      const id = getSerializedNodeId(target)\n      const scrollPositions =\n        target === document\n          ? {\n              scrollTop: getScrollY(),\n              scrollLeft: getScrollX(),\n            }\n          : {\n              scrollTop: Math.round((target as HTMLElement).scrollTop),\n              scrollLeft: Math.round((target as HTMLElement).scrollLeft),\n            }\n      elementsScrollPositions.set(target, scrollPositions)\n      cb({\n        id,\n        x: scrollPositions.scrollLeft,\n        y: scrollPositions.scrollTop,\n      })\n    }),\n    SCROLL_OBSERVER_THRESHOLD\n  )\n  return addEventListener(document, DOM_EVENT.SCROLL, updatePosition, { capture: true, passive: true }).stop\n}\n\nfunction initViewportResizeObserver(cb: ViewportResizeCallback): ListenerHandler {\n  return initViewportObservable().subscribe(cb).unsubscribe\n}\n\ntype InputObserverOptions = {\n  domEvents?: Array<DOM_EVENT.INPUT | DOM_EVENT.CHANGE>\n  target?: Node\n}\nexport function initInputObserver(\n  cb: InputCallback,\n  defaultPrivacyLevel: DefaultPrivacyLevel,\n  { domEvents = [DOM_EVENT.INPUT, DOM_EVENT.CHANGE], target = document }: InputObserverOptions = {}\n): ListenerHandler {\n  const lastInputStateMap: WeakMap<Node, InputState> = new WeakMap()\n\n  function onElementChange(target: HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement) {\n    const nodePrivacyLevel = getNodePrivacyLevel(target, defaultPrivacyLevel)\n    if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {\n      return\n    }\n\n    const type = target.type\n\n    let inputState: InputState\n    if (type === 'radio' || type === 'checkbox') {\n      if (shouldMaskNode(target, nodePrivacyLevel)) {\n        return\n      }\n      inputState = { isChecked: (target as HTMLInputElement).checked }\n    } else {\n      const value = getElementInputValue(target, nodePrivacyLevel)\n      if (value === undefined) {\n        return\n      }\n      inputState = { text: value }\n    }\n\n    // Can be multiple changes on the same node within the same batched mutation observation.\n    cbWithDedup(target, inputState)\n\n    // If a radio was checked, other radios with the same name attribute will be unchecked.\n    const name = target.name\n    if (type === 'radio' && name && (target as HTMLInputElement).checked) {\n      forEach(document.querySelectorAll(`input[type=\"radio\"][name=\"${name}\"]`), (el: Element) => {\n        if (el !== target) {\n          // TODO: Consider the privacy implications for various differing input privacy levels\n          cbWithDedup(el, { isChecked: false })\n        }\n      })\n    }\n  }\n\n  /**\n   * There can be multiple changes on the same node within the same batched mutation observation.\n   */\n  function cbWithDedup(target: Node, inputState: InputState) {\n    if (!hasSerializedNode(target)) {\n      return\n    }\n    const lastInputState = lastInputStateMap.get(target)\n    if (\n      !lastInputState ||\n      (lastInputState as { text?: string }).text !== (inputState as { text?: string }).text ||\n      (lastInputState as { isChecked?: boolean }).isChecked !== (inputState as { isChecked?: boolean }).isChecked\n    ) {\n      lastInputStateMap.set(target, inputState)\n      cb(\n        assign(\n          {\n            id: getSerializedNodeId(target),\n          },\n          inputState\n        )\n      )\n    }\n  }\n\n  const { stop: stopEventListeners } = addEventListeners(\n    target,\n    domEvents,\n    (event) => {\n      const target = getEventTarget(event)\n      if (\n        target instanceof HTMLInputElement ||\n        target instanceof HTMLTextAreaElement ||\n        target instanceof HTMLSelectElement\n      ) {\n        onElementChange(target)\n      }\n    },\n    {\n      capture: true,\n      passive: true,\n    }\n  )\n\n  const instrumentationStoppers = [\n    instrumentSetter(HTMLInputElement.prototype, 'value', onElementChange),\n    instrumentSetter(HTMLInputElement.prototype, 'checked', onElementChange),\n    instrumentSetter(HTMLSelectElement.prototype, 'value', onElementChange),\n    instrumentSetter(HTMLTextAreaElement.prototype, 'value', onElementChange),\n    instrumentSetter(HTMLSelectElement.prototype, 'selectedIndex', onElementChange),\n  ]\n\n  return () => {\n    instrumentationStoppers.forEach((stopper) => stopper.stop())\n    stopEventListeners()\n  }\n}\n\nexport function initStyleSheetObserver(cb: StyleSheetCallback): ListenerHandler {\n  function checkStyleSheetAndCallback(styleSheet: CSSStyleSheet | null, callback: (id: number) => void): void {\n    if (styleSheet && hasSerializedNode(styleSheet.ownerNode!)) {\n      callback(getSerializedNodeId(styleSheet.ownerNode))\n    }\n  }\n\n  const instrumentationStoppers = [\n    instrumentMethodAndCallOriginal(CSSStyleSheet.prototype, 'insertRule', {\n      before(rule, index) {\n        checkStyleSheetAndCallback(this, (id) => cb({ id, adds: [{ rule, index }] }))\n      },\n    }),\n    instrumentMethodAndCallOriginal(CSSStyleSheet.prototype, 'deleteRule', {\n      before(index) {\n        checkStyleSheetAndCallback(this, (id) => cb({ id, removes: [{ index }] }))\n      },\n    }),\n  ]\n\n  if (typeof CSSGroupingRule !== 'undefined') {\n    instrumentGroupingCSSRuleClass(CSSGroupingRule)\n  } else {\n    instrumentGroupingCSSRuleClass(CSSMediaRule)\n    instrumentGroupingCSSRuleClass(CSSSupportsRule)\n  }\n\n  function instrumentGroupingCSSRuleClass(cls: GroupingCSSRuleTypes) {\n    instrumentationStoppers.push(\n      instrumentMethodAndCallOriginal(cls.prototype, 'insertRule', {\n        before(rule, index) {\n          checkStyleSheetAndCallback(this.parentStyleSheet, (id) => {\n            const path = getPathToNestedCSSRule(this)\n            if (path) {\n              path.push(index || 0)\n              cb({ id, adds: [{ rule, index: path }] })\n            }\n          })\n        },\n      }),\n      instrumentMethodAndCallOriginal(cls.prototype, 'deleteRule', {\n        before(index) {\n          checkStyleSheetAndCallback(this.parentStyleSheet, (id) => {\n            const path = getPathToNestedCSSRule(this)\n            if (path) {\n              path.push(index)\n              cb({ id, removes: [{ index: path }] })\n            }\n          })\n        },\n      })\n    )\n  }\n\n  return () => instrumentationStoppers.forEach((stopper) => stopper.stop())\n}\n\nfunction initMediaInteractionObserver(\n  mediaInteractionCb: MediaInteractionCallback,\n  defaultPrivacyLevel: DefaultPrivacyLevel\n): ListenerHandler {\n  const handler = (event: Event) => {\n    const target = getEventTarget(event)\n    if (\n      !target ||\n      getNodePrivacyLevel(target, defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN ||\n      !hasSerializedNode(target)\n    ) {\n      return\n    }\n    mediaInteractionCb({\n      id: getSerializedNodeId(target),\n      type: event.type === DOM_EVENT.PLAY ? MediaInteractionType.Play : MediaInteractionType.Pause,\n    })\n  }\n  return addEventListeners(document, [DOM_EVENT.PLAY, DOM_EVENT.PAUSE], handler, { capture: true, passive: true }).stop\n}\n\nfunction initFocusObserver(focusCb: FocusCallback): ListenerHandler {\n  return addEventListeners(window, [DOM_EVENT.FOCUS, DOM_EVENT.BLUR], () => {\n    focusCb({ has_focus: document.hasFocus() })\n  }).stop\n}\n\nfunction initVisualViewportResizeObserver(cb: VisualViewportResizeCallback): ListenerHandler {\n  if (!window.visualViewport) {\n    return noop\n  }\n  const { throttled: updateDimension, cancel: cancelThrottle } = throttle(\n    monitor(() => {\n      cb(getVisualViewport())\n    }),\n    VISUAL_VIEWPORT_OBSERVER_THRESHOLD,\n    {\n      trailing: false,\n    }\n  )\n  const removeListener = addEventListeners(\n    window.visualViewport,\n    [DOM_EVENT.RESIZE, DOM_EVENT.SCROLL],\n    updateDimension,\n    {\n      capture: true,\n      passive: true,\n    }\n  ).stop\n\n  return function stop() {\n    removeListener()\n    cancelThrottle()\n  }\n}\n\nexport function initFrustrationObserver(lifeCycle: LifeCycle, frustrationCb: FrustrationCallback): ListenerHandler {\n  return lifeCycle.subscribe(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, (data) => {\n    if (\n      data.rawRumEvent.type === RumEventType.ACTION &&\n      data.rawRumEvent.action.type === ActionType.CLICK &&\n      data.rawRumEvent.action.frustration?.type?.length &&\n      'events' in data.domainContext &&\n      data.domainContext.events?.length\n    ) {\n      frustrationCb({\n        timestamp: data.rawRumEvent.date,\n        type: RecordType.FrustrationRecord,\n        data: {\n          frustrationTypes: data.rawRumEvent.action.frustration.type,\n          recordIds: data.domainContext.events.map((e) => getRecordIdForEvent(e)),\n        },\n      })\n    }\n  }).unsubscribe\n}\n\nfunction getEventTarget(event: Event): Node {\n  if (event.composed === true && isNodeShadowHost(event.target as Node)) {\n    return event.composedPath()[0] as Node\n  }\n  return event.target as Node\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}