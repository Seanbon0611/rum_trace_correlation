{"ast":null,"code":"import { display } from '../tools/display';\nimport { findCommaSeparatedValue, generateUUID, ONE_MINUTE, ONE_SECOND } from '../tools/utils';\nexport var COOKIE_ACCESS_DELAY = ONE_SECOND;\nexport function setCookie(name, value, expireDelay, options) {\n  var date = new Date();\n  date.setTime(date.getTime() + expireDelay);\n  var expires = \"expires=\".concat(date.toUTCString());\n  var sameSite = options && options.crossSite ? 'none' : 'strict';\n  var domain = options && options.domain ? \";domain=\".concat(options.domain) : '';\n  var secure = options && options.secure ? ';secure' : '';\n  document.cookie = \"\".concat(name, \"=\").concat(value, \";\").concat(expires, \";path=/;samesite=\").concat(sameSite).concat(domain).concat(secure);\n}\nexport function getCookie(name) {\n  return findCommaSeparatedValue(document.cookie, name);\n}\nexport function deleteCookie(name, options) {\n  setCookie(name, '', 0, options);\n}\nexport function areCookiesAuthorized(options) {\n  if (document.cookie === undefined || document.cookie === null) {\n    return false;\n  }\n  try {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    var testCookieName = \"dd_cookie_test_\".concat(generateUUID());\n    var testCookieValue = 'test';\n    setCookie(testCookieName, testCookieValue, ONE_MINUTE, options);\n    var isCookieCorrectlySet = getCookie(testCookieName) === testCookieValue;\n    deleteCookie(testCookieName, options);\n    return isCookieCorrectlySet;\n  } catch (error) {\n    display.error(error);\n    return false;\n  }\n}\n/**\n * No API to retrieve it, number of levels for subdomain and suffix are unknown\n * strategy: find the minimal domain on which cookies are allowed to be set\n * https://web.dev/same-site-same-origin/#site\n */\nvar getCurrentSiteCache;\nexport function getCurrentSite() {\n  if (getCurrentSiteCache === undefined) {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    var testCookieName = \"dd_site_test_\".concat(generateUUID());\n    var testCookieValue = 'test';\n    var domainLevels = window.location.hostname.split('.');\n    var candidateDomain = domainLevels.pop();\n    while (domainLevels.length && !getCookie(testCookieName)) {\n      candidateDomain = \"\".concat(domainLevels.pop(), \".\").concat(candidateDomain);\n      setCookie(testCookieName, testCookieValue, ONE_SECOND, {\n        domain: candidateDomain\n      });\n    }\n    deleteCookie(testCookieName, {\n      domain: candidateDomain\n    });\n    getCurrentSiteCache = candidateDomain;\n  }\n  return getCurrentSiteCache;\n}","map":{"version":3,"names":["display","findCommaSeparatedValue","generateUUID","ONE_MINUTE","ONE_SECOND","COOKIE_ACCESS_DELAY","setCookie","name","value","expireDelay","options","date","Date","setTime","getTime","expires","concat","toUTCString","sameSite","crossSite","domain","secure","document","cookie","getCookie","deleteCookie","areCookiesAuthorized","undefined","testCookieName","testCookieValue","isCookieCorrectlySet","error","getCurrentSiteCache","getCurrentSite","domainLevels","window","location","hostname","split","candidateDomain","pop","length"],"sources":["/Users/sean.dever/Desktop/PersonalRepos/apm-enablement-sessions/rum_and_trace_correlation/react-app/node_modules/@datadog/browser-core/src/browser/cookie.ts"],"sourcesContent":["import { display } from '../tools/display'\nimport { findCommaSeparatedValue, generateUUID, ONE_MINUTE, ONE_SECOND } from '../tools/utils'\n\nexport const COOKIE_ACCESS_DELAY = ONE_SECOND\n\nexport interface CookieOptions {\n  secure?: boolean\n  crossSite?: boolean\n  domain?: string\n}\n\nexport function setCookie(name: string, value: string, expireDelay: number, options?: CookieOptions) {\n  const date = new Date()\n  date.setTime(date.getTime() + expireDelay)\n  const expires = `expires=${date.toUTCString()}`\n  const sameSite = options && options.crossSite ? 'none' : 'strict'\n  const domain = options && options.domain ? `;domain=${options.domain}` : ''\n  const secure = options && options.secure ? ';secure' : ''\n  document.cookie = `${name}=${value};${expires};path=/;samesite=${sameSite}${domain}${secure}`\n}\n\nexport function getCookie(name: string) {\n  return findCommaSeparatedValue(document.cookie, name)\n}\n\nexport function deleteCookie(name: string, options?: CookieOptions) {\n  setCookie(name, '', 0, options)\n}\n\nexport function areCookiesAuthorized(options: CookieOptions): boolean {\n  if (document.cookie === undefined || document.cookie === null) {\n    return false\n  }\n  try {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    const testCookieName = `dd_cookie_test_${generateUUID()}`\n    const testCookieValue = 'test'\n    setCookie(testCookieName, testCookieValue, ONE_MINUTE, options)\n    const isCookieCorrectlySet = getCookie(testCookieName) === testCookieValue\n    deleteCookie(testCookieName, options)\n    return isCookieCorrectlySet\n  } catch (error) {\n    display.error(error)\n    return false\n  }\n}\n\n/**\n * No API to retrieve it, number of levels for subdomain and suffix are unknown\n * strategy: find the minimal domain on which cookies are allowed to be set\n * https://web.dev/same-site-same-origin/#site\n */\nlet getCurrentSiteCache: string | undefined\nexport function getCurrentSite() {\n  if (getCurrentSiteCache === undefined) {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    const testCookieName = `dd_site_test_${generateUUID()}`\n    const testCookieValue = 'test'\n\n    const domainLevels = window.location.hostname.split('.')\n    let candidateDomain = domainLevels.pop()!\n    while (domainLevels.length && !getCookie(testCookieName)) {\n      candidateDomain = `${domainLevels.pop()!}.${candidateDomain}`\n      setCookie(testCookieName, testCookieValue, ONE_SECOND, { domain: candidateDomain })\n    }\n    deleteCookie(testCookieName, { domain: candidateDomain })\n    getCurrentSiteCache = candidateDomain\n  }\n  return getCurrentSiteCache\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}