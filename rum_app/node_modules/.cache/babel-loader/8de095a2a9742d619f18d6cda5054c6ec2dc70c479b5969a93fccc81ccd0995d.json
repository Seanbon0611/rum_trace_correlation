{"ast":null,"code":"import { callMonitored, monitor } from './monitor';\nimport { noop } from './utils';\nexport function instrumentMethod(object, method, instrumentationFactory) {\n  var original = object[method];\n  var instrumentation = instrumentationFactory(original);\n  var instrumentationWrapper = function () {\n    if (typeof instrumentation !== 'function') {\n      return undefined;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return instrumentation.apply(this, arguments);\n  };\n  object[method] = instrumentationWrapper;\n  return {\n    stop: function () {\n      if (object[method] === instrumentationWrapper) {\n        object[method] = original;\n      } else {\n        instrumentation = original;\n      }\n    }\n  };\n}\nexport function instrumentMethodAndCallOriginal(object, method, _a) {\n  var before = _a.before,\n    after = _a.after;\n  return instrumentMethod(object, method, function (original) {\n    return function () {\n      var args = arguments;\n      var result;\n      if (before) {\n        callMonitored(before, this, args);\n      }\n      if (typeof original === 'function') {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n        result = original.apply(this, args);\n      }\n      if (after) {\n        callMonitored(after, this, args);\n      }\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return result;\n    };\n  });\n}\nexport function instrumentSetter(object, property, after) {\n  var originalDescriptor = Object.getOwnPropertyDescriptor(object, property);\n  if (!originalDescriptor || !originalDescriptor.set || !originalDescriptor.configurable) {\n    return {\n      stop: noop\n    };\n  }\n  var instrumentation = function (thisObject, value) {\n    // put hooked setter into event loop to avoid of set latency\n    setTimeout(monitor(function () {\n      after(thisObject, value);\n    }), 0);\n  };\n  var instrumentationWrapper = function (value) {\n    originalDescriptor.set.call(this, value);\n    instrumentation(this, value);\n  };\n  Object.defineProperty(object, property, {\n    set: instrumentationWrapper\n  });\n  return {\n    stop: function () {\n      var _a;\n      if (((_a = Object.getOwnPropertyDescriptor(object, property)) === null || _a === void 0 ? void 0 : _a.set) === instrumentationWrapper) {\n        Object.defineProperty(object, property, originalDescriptor);\n      } else {\n        instrumentation = noop;\n      }\n    }\n  };\n}","map":{"version":3,"names":["callMonitored","monitor","noop","instrumentMethod","object","method","instrumentationFactory","original","instrumentation","instrumentationWrapper","undefined","apply","arguments","stop","instrumentMethodAndCallOriginal","_a","before","after","args","result","instrumentSetter","property","originalDescriptor","Object","getOwnPropertyDescriptor","set","configurable","thisObject","value","setTimeout","call","defineProperty"],"sources":["/Users/sean.dever/Desktop/PersonalRepos/rum_and_trace_correlation/rum_app/node_modules/@datadog/browser-core/src/tools/instrumentMethod.ts"],"sourcesContent":["import { callMonitored, monitor } from './monitor'\nimport { noop } from './utils'\n\nexport function instrumentMethod<OBJECT extends { [key: string]: any }, METHOD extends keyof OBJECT>(\n  object: OBJECT,\n  method: METHOD,\n  instrumentationFactory: (\n    original: OBJECT[METHOD]\n  ) => (this: OBJECT, ...args: Parameters<OBJECT[METHOD]>) => ReturnType<OBJECT[METHOD]>\n) {\n  const original = object[method]\n\n  let instrumentation = instrumentationFactory(original)\n\n  const instrumentationWrapper = function (this: OBJECT): ReturnType<OBJECT[METHOD]> | undefined {\n    if (typeof instrumentation !== 'function') {\n      return undefined\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return instrumentation.apply(this, arguments as unknown as Parameters<OBJECT[METHOD]>)\n  }\n  object[method] = instrumentationWrapper as OBJECT[METHOD]\n\n  return {\n    stop: () => {\n      if (object[method] === instrumentationWrapper) {\n        object[method] = original\n      } else {\n        instrumentation = original\n      }\n    },\n  }\n}\n\nexport function instrumentMethodAndCallOriginal<OBJECT extends { [key: string]: any }, METHOD extends keyof OBJECT>(\n  object: OBJECT,\n  method: METHOD,\n  {\n    before,\n    after,\n  }: {\n    before?: (this: OBJECT, ...args: Parameters<OBJECT[METHOD]>) => void\n    after?: (this: OBJECT, ...args: Parameters<OBJECT[METHOD]>) => void\n  }\n) {\n  return instrumentMethod(\n    object,\n    method,\n    (original) =>\n      function () {\n        const args = arguments as unknown as Parameters<OBJECT[METHOD]>\n        let result\n\n        if (before) {\n          callMonitored(before, this as ThisParameterType<OBJECT[METHOD]>, args)\n        }\n\n        if (typeof original === 'function') {\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n          result = original.apply(this, args)\n        }\n\n        if (after) {\n          callMonitored(after, this as ThisParameterType<OBJECT[METHOD]>, args)\n        }\n\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return result\n      }\n  )\n}\n\nexport function instrumentSetter<OBJECT extends { [key: string]: any }, PROPERTY extends keyof OBJECT>(\n  object: OBJECT,\n  property: PROPERTY,\n  after: (thisObject: OBJECT, value: OBJECT[PROPERTY]) => void\n) {\n  const originalDescriptor = Object.getOwnPropertyDescriptor(object, property)\n  if (!originalDescriptor || !originalDescriptor.set || !originalDescriptor.configurable) {\n    return { stop: noop }\n  }\n\n  let instrumentation = (thisObject: OBJECT, value: OBJECT[PROPERTY]) => {\n    // put hooked setter into event loop to avoid of set latency\n    setTimeout(\n      monitor(() => {\n        after(thisObject, value)\n      }),\n      0\n    )\n  }\n\n  const instrumentationWrapper = function (this: OBJECT, value: OBJECT[PROPERTY]) {\n    originalDescriptor.set!.call(this, value)\n    instrumentation(this, value)\n  }\n\n  Object.defineProperty(object, property, {\n    set: instrumentationWrapper,\n  })\n\n  return {\n    stop: () => {\n      if (Object.getOwnPropertyDescriptor(object, property)?.set === instrumentationWrapper) {\n        Object.defineProperty(object, property, originalDescriptor)\n      } else {\n        instrumentation = noop\n      }\n    },\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}